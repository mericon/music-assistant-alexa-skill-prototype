Music Assistant Alexa Skill (Docker-based, Native Playback)

This project provides a self-hosted Alexa Skill that integrates directly with Music Assistant using native Alexa AudioPlayer APIs.

It is designed as a modern replacement for AlexaPy-based solutions and focuses on low latency, correct playback state handling, and clean architecture.

âœ¨ Features

ğŸµ Native Music Assistant queue integration

âš¡ Instant pause / resume (no AlexaPy delays)

ğŸ³ Fully Docker & Docker Compose based

ğŸ§  Alexa acts as pure audio output, MA remains the playback authority

ğŸ” Proper playback offset synchronization

ğŸ” Ready for HTTPS reverse proxies (Caddy / Traefik / Cloudflare Tunnel)

ğŸ§± Architecture Overview
Alexa Device
     â”‚
     â–¼
Alexa Skill (HTTP / AudioPlayer)
     â”‚
     â–¼
Music Assistant Alexa API Bridge
     â”‚
     â–¼
Music Assistant Core (Queue & Playback)

Components
Component	Description
Alexa Skill Service	Lambda-compatible HTTP service handling Alexa requests
MA Alexa API	Bridge translating Alexa playback events to Music Assistant
Music Assistant	Owns queues, tracks, playback state
ğŸ“ Repository Structure
music-assistant-alexa-skill-prototype/
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ .env
â”‚
â”œâ”€â”€ alexa-skill/
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â”œâ”€â”€ lambda_function.py
â”‚   â”œâ”€â”€ music_assistant.py
â”‚   â””â”€â”€ requirements.txt
â”‚
â”œâ”€â”€ music-assistant-api/
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â”œâ”€â”€ api.py
â”‚   â”œâ”€â”€ ma_client.py
â”‚   â”œâ”€â”€ stream.py
â”‚   â”œâ”€â”€ state.py
â”‚   â”œâ”€â”€ alexa_state.py
â”‚   â””â”€â”€ requirements.txt
â”‚
â””â”€â”€ interactionModels/
    â””â”€â”€ custom/
        â””â”€â”€ de-DE.json

ğŸ”§ Prerequisites

Docker & Docker Compose

A running Music Assistant instance

A long-lived Music Assistant API token

Alexa Developer Account

ğŸ” Music Assistant Setup

Open Music Assistant

Go to Settings â†’ API

Create a Long-Lived Access Token

Note:

Hostname / IP

Port (default: 8095)

API token

âš™ï¸ Configuration
.env
# Internal Docker communication
MA_BASE_URL=http://music-assistant-api:5000

# External Music Assistant connection
MA_HOST=musicassistant.local
MA_PORT=8095
MA_API_KEY=YOUR_LONG_LIVED_TOKEN

ğŸ³ Docker Compose
docker-compose.yml
version: "3.9"

services:
  alexa-skill:
    build: ./alexa-skill
    container_name: alexa-skill
    env_file: .env
    ports:
      - "5985:8080"
    depends_on:
      - music-assistant-api

  music-assistant-api:
    build: ./music-assistant-api
    container_name: music-assistant-api
    env_file: .env
    ports:
      - "5000:5000"

â–¶ï¸ Start the Services
docker compose up --build

Service Endpoints
Service	URL
Alexa Skill Endpoint	http://localhost:5985
MA Alexa API	http://localhost:5000
ğŸ—£ Alexa Skill Setup
1. Create Skill

Alexa Developer Console â†’ Create Skill

Skill type: Custom

Backend: HTTPS endpoint

Language: de-DE (or adapt model)

2. Endpoint

âš ï¸ Alexa requires HTTPS for real devices

Use one of:

Reverse proxy (Caddy / Traefik)

Cloudflare Tunnel

Public HTTPS endpoint

Example:

https://alexa.example.com/

3. Interaction Model

Import:

interactionModels/custom/de-DE.json

ğŸµ Playback Flow
â–¶ï¸ Play

Alexa requests stream

MA queue is queried

Alexa receives direct MA stream URL

â¸ Pause

Alexa stops immediately

Offset is sent to MA

MA pauses the queue

â–¶ï¸ Resume

Alexa requests stream

MA seeks to last offset

Playback resumes exactly

ğŸš« What This Project Does NOT Do

âŒ No AlexaPy

âŒ No Alexa Media Player

âŒ No polling or hacks

âŒ No dummy streams

âš ï¸ Notes & Limitations

Alexa requires public HTTPS for physical devices

Multi-room Alexa groups require additional handling

Offset accuracy depends on Alexa AudioPlayer events

ğŸ§ª Testing

Use Alexa Developer Console Simulator

Watch logs via:

docker compose logs -f

ğŸ›  Troubleshooting
Alexa says â€œThe skill is not respondingâ€

HTTPS missing or invalid

Endpoint unreachable from internet

Playback does not resume correctly

Check MA API token permissions

Verify queue IDs

Inspect /api/alexa/state logs

ğŸš€ Future Improvements

Automatic next-track handling

Persistent state storage

Speaker group awareness

Full Alexa Smart Home integration

ğŸ“œ License

MIT License